<!doctype html>
<html>
<head>
  <title>주문 페이지 (user-service)</title>
  <style>
    #app-name-input {
      position: fixed;
      top: 10px;
      right: 140px;
      width: 200px;
      padding: 6px;
      z-index: 1000;
    }
    #release-message-input {
      position: fixed;
      top: 45px;  /* app-name-input 바로 아래 */
      right: 140px;
      width: 200px;
      padding: 6px;
      z-index: 1000;
    }
    #release-btn {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: #007bff;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1000;
    }
    #release-btn:hover {
      background-color: #0056b3;
    }
  </style>
  <script>
    async function sendOrder() {
      const selected = Array.from(document.querySelectorAll('input[name="product_ids"]:checked')).map(cb => cb.value);
      if(selected.length === 0) {
        alert("상품을 선택해 주세요!");
        return;
      }
/*
      if(someErrorCondition){
        throw new Error("Instana 테스트용 강제 에러 - 주문 처리 중");
      }
*/
      const resp = await fetch('/order', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({product_ids: selected})
      });
      const data = await resp.json();
      const resultDiv = document.getElementById('result');
      if(data.error){
        resultDiv.innerText = "주문 처리 오류: " + data.error;
      } else {
        resultDiv.innerHTML = "<h3>주문 완료</h3><p>주문 ID: " + data.order_id + "</p><ul>" +
          data.products.map(p => `<li>${p.id} - ${p.name}</li>`).join('') +
          "</ul>";
      }
    }
  </script>
  <script>
    (function(s,t,a,n){s[t]||(s[t]=a,n=s[a]=function(){n.q.push(arguments)},
    n.q=[],n.v=2,n.l=1*new Date)})(window,"InstanaEumObject","ineum");
  
    ineum('reportingUrl', 'https://automation.ibmce-kr.com/eum/');
    ineum('key', 'YQr53nnRRxe_hgOyPtCdIQ');
    ineum('trackSessions');
    // Custom Data
    ineum('page', 'homepage');
    ineum('meta', 'version', '1.0.0');
    ineum('meta', 'userRole', 'admin');
    ineum('user', 'testuser', 'test@test.com');
  </script>
  <script defer crossorigin="anonymous" src="https://automation.ibmce-kr.com/eum/1.7.5/eum.min.js" 
   integrity="sha384-HJjb3vveemdYNUfM1D28dTeXpPPbwPWJinH9ldaGt3KxCO0PNRc4Jb3oQIxMmJMk"></script>
<script>
  // 기존 sendOrder 아래나 같은 영역에 추가
  function forceError() {
    throw new Error("Instana 테스트용 강제 에러 발생");
  }
</script>
</head>
<body>
  <!-- 애플리케이션 이름 입력 -->
  <input id="app-name-input" type="text" placeholder="애플리케이션 이름 입력" />

  <!-- 보낼 메시지 입력창 -->
  <input id="release-message-input" type="text" placeholder="보낼 메시지 입력" />

  <!-- Release Mark 버튼 -->
  <button id="release-btn" onclick="sendReleaseMark()">Release Mark 보내기</button>

  <h1>상품 선택 및 주문 (user-service)</h1>
  <form onsubmit="event.preventDefault(); sendOrder();">
    {% for p in products %}
      <input type="checkbox" name="product_ids" value="{{ p.id }}"> {{ p.name }}<br>
    {% endfor %}
    <br>
    <button type="submit">주문하기</button>
  </form>
  <div id="result"></div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 테스트용 에러 발생 버튼 추가
    const btn = document.createElement('button');
    btn.innerText = '에러 발생 테스트';
    btn.onclick = () => {
      throw new Error("Instana 테스트용 강제 에러 - 버튼 클릭");
    };
    document.body.appendChild(btn);
  });
</script>

  <!-- JavaScript 파일 불러오기 -->
  <script src="/static/js/release_mark.js"></script>

</body>
</html>

